<div class="container mt-3">
    <!-- Título da página -->
    <h3>Casa Colombo</h3>
    <p>Construir, Reformar e Decorar</p>
    <!-- Botão para cadastro de produto -->
    <div class="input-group mb-3">
        <button class="btn btn-success" type="button" (click)="filtrarProdutos()">Pesquisar</button>
        <input type="text" class="form-control" placeholder="Digite o nome do produto" aria-label="Pesquisar"
            aria-describedby="basic-addon1" [(ngModel)]="expression" (input)="filtrarProdutos()">
    </div>
    <!-- Tabela para exibir a consulta de produtos -->
    <div class="table-responsive">
        <table class="table table-bordered table-hover">
            <!-- cabeçalho da tabela -->
            <thead>
                <tr>
                    <th>Miniatura</th>
                    <th>Detalhes</th>
                    <th>Código</th>
                    <th>Nome do produto</th>
                    <th>Descrição</th>
                    <th>Pei</th>
                    <th>Marca</th>
                    <th>Preço M²</th>
                    <th>M² CX</th>
                    <th>Preço CX</th>
                    <th>Peças CX</th>
                    <th>Qtd CX</th>
                    <th>Operação</th>
                </tr>
            </thead>
            <!-- Corpo da tabela -->
            <tbody>
                <ng-container *ngFor="let produto of produtos">
                    <tr>
                        <!-- Colunas para exibir os detalhes básicos do produto -->
                        <td><img [src]="produto.imagemUrl" alt="{{ produto.nome }}" width="50"
                                (click)="expandirImagem(produto.imagemUrl)"></td>
                        <td>
                            <button class="btn  btn-outline-success" (click)="toggleDetalhes(produto)">+</button>
                        </td>
                        <td>{{ produto.codigo }}</td>
                        <td>{{ produto.nome | uppercase }}</td>
                        <td>{{ produto.descricao }}</td>
                        <td>{{ produto.pei }}</td>
                        <td>{{ produto.marca }}</td>
                        <td>{{ produto.precoMetroQ | currency:'BRL':'symbol':'1.2-2'}}</td>
                        <td>{{ produto.metroQCaixa }}</td>
                        <td>{{ produto.precoCaixa | currency:'BRL':'symbol':'1.2-2'}}</td>
                        <td>{{ produto.pecasCaixa }}</td>
                        <td>{{ produto.quantidade }}</td>

                        <!-- Botão de editar -->
                        <td>
                            <button class="btn btn-sm btn-outline-success me-2" (click)="editarProduto(produto.id)">
                                Editar
                            </button>
                        </td>
                    </tr>
                    <!-- Linha para exibir os detalhes adicionais -->
                    <tr *ngIf="produto.mostrarDetalhes">
                        <td colspan="13">
                            <!-- Tabela para os detalhes dos lotes -->
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Número do Lote</th>
                                        <th>Quantidade</th>
                                        <th>Endereço</th>
                                        <th>Quantidade Vendida</th>
                                        <th>Confirmar Venda</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Use um ngFor para iterar sobre os lotes -->
                                    <tr *ngFor="let lote of produto.lotes">
                                        <td>{{ lote.numeroLote }}</td>
                                        <td>{{ lote.quantidadeLote }}</td>
                                        <td>{{lote.ala}}</td>
                                        <!-- Coluna para quantidade vendida -->
                                        <td>
                                            <input type="number" min="0" [(ngModel)]="lote.quantidadeVendida"
                                                style="width: 50px;">
                                        </td>
                                        <!-- Botão de vender -->
                                        <td>
                                            <button class="btn btn-success"
                                                (click)="abrirFormularioCredenciais(lote)">Vender</button>


                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </td>
                    </tr>
                </ng-container>
            </tbody>
            <!-- rodapé da tabela -->

        </table>
        <tfoot>
            <tr>
                <td colspan="14">
                    Quantidade de produtos: {{ produtos.length }}
                </td>
            </tr>
        </tfoot>
    </div>

</div>



<div class="imagem-ampliada" *ngIf="imagemAmpliadaUrl">
    <button class="btn-close" (click)="fecharImagemAmpliada()">&times;</button>
    <img [src]="imagemAmpliadaUrl" alt="Imagem Ampliada">
</div>

<div class="formulario-credenciais text-center" *ngIf="loteSelecionado && loteSelecionado === loteSelecionado">
    <button class="btn-close btn-close-white" (click)="fecharFormularioCredenciais()">&times;</button>
    <h4>Confirme a sua venda</h4>
    <div class="mb-3">
        <label for="matriculaInput" class="form-label">Matrícula</label>
        <input type="text" class="form-control" id="matriculaInput" placeholder="Digite sua matrícula" [(ngModel)]="matricula">
    </div>
    <div class="mb-3">
        <label for="senhaInput" class="form-label">Senha</label>
        <input type="password" class="form-control" id="senhaInput" placeholder="Digite sua senha" [(ngModel)]="senha">
    </div>
    <button class="btn btn-outline-light" (click)="confirmarVenda(loteSelecionado)"style="font-weight: bold;">Confirmar</button>
</div>
