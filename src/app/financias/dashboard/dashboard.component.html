<div class="container-fluid py-4" [class.dark-mode]="isDarkMode">

  <header class="d-flex justify-content-between align-items-center mb-4 position-relative">
    <!-- BotÃµes alinhados Ã  esquerda -->
    <div class="d-flex align-items-center gap-3">
      <button class="btn btn-outline-secondary" (click)="toggleDarkMode()" title="Alternar Modo Escuro">
        <i class="bi" [ngClass]="{'bi-sun-fill': isDarkMode, 'bi-moon-fill': !isDarkMode}"></i>
      </button>

      <!-- Menu principal -->
      <div class="dropdown">
        <button class="btn btn-success dropdown" id="menuAcoes" data-bs-toggle="dropdown" aria-expanded="false">
          <i class="bi bi-plus-circle-fill me-1"></i> AÃ§Ãµes
        </button>

        <ul class="dropdown-menu" aria-labelledby="menuAcoes">
          <!-- Compras -->
          <li class="dropdown-submenu">
            <a class="dropdown-item dropdown">Compras</a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" routerLink="/compras"><i class="bi bi-cart-check"></i> Consultar Compras</a>
              </li>
              <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#cadastrarCompras"><i
                    class="bi bi-cart-plus"></i> Cadastrar Compra</a></li>
            </ul>
          </li>



          <!-- CobranÃ§as -->
          <li class="dropdown-submenu">
            <a class="dropdown-item dropdown">CobranÃ§as</a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" routerLink="/cobranca"><i class="bi bi-cash-coin"></i> Consultar
                  CobranÃ§as</a></li>
              <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#cadastrarCobrancas"
                  (click)="abrirModalCobranca()"><i class="bi bi-currency-dollar"></i> Cadastrar CobranÃ§a</a></li>
            </ul>
          </li>



          <!-- Despesas 
          <li class="dropdown-submenu">
            <a class="dropdown-item dropdown" href="#">Despesas</a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" routerLink="/despesas"><i class="bi bi-cash-coin"></i> Consultar Despesas</a>
              </li>
              <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#despesas"><i class="bi bi-tag"></i>
                  Cadastrar Despesa</a></li>
            </ul>
          </li>-->

          <li class="dropdown-submenu">
            <a class="dropdown-item dropdown">Fornecedor</a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" routerLink="/fornecedor"><i class="bi bi-truck"></i> Consultar Fornecedor</a>
              </li>
              <li><a class="dropdown-item" data-bs-toggle="modal" data-bs-target="#cadastrarFornecedor"><i
                    class="bi bi-person-badge"></i> Cadastrar Fornecedor</a></li>
            </ul>
          </li>

          <!-- Despesas Loja -->
          <li class="dropdown-submenu">
            <a class="dropdown-item dropdown" routerLink="/despesas-loja">Despesas-Loja</a>
            <!--<ul class="dropdown-menu">
             <li><a class="dropdown-item" routerLink="/despesas-loja"><i class="bi bi-shop"></i> Consultar Despesas</a>
              </li>
            </ul>-->
          </li>
        </ul>
      </div>
    </div>

    <!-- TÃ­tulo centralizado -->
    <h2 class="text-primary-emphasis position-absolute start-50 translate-middle-x mb-0">
      Painel de Controle Financeiro
    </h2>
  </header>


  <div *ngIf="mensagem" class="alert alert-success alert-dismissible fade show animated-alert" role="alert">
    <strong>{{mensagem}}</strong>
    <button (click)="mensagem = ''" type="button" class="btn-close" aria-label="Close"></button>
  </div>
  <div *ngIf="mensagemErro" class="alert alert-danger alert-dismissible fade show animated-alert" role="alert">
    <strong>{{mensagemErro}}</strong>
    <button (click)="mensagemErro = ''" type="button" class="btn-close" aria-label="Close"></button>
  </div>






  <div class="row g-8 mb-8">
    <div class="row">

      <div class="col-md-6">

        <div class="row g-4">
          <h2 class="text-center cursor-pointer" (click)="abrirModal('compras')">
            Compras
          </h2>
          <div class="col-md-3">
            <a [routerLink]="['/compras']" [queryParams]="{ filtroDashboard: 'ano-anterior' }"
              class="text-decoration-none h-100">
              <div class="animated-card bg-primary-subtle text-primary p-3 shadow-sm h-100">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="card-subtitle text-uppercase fw-bold mb-1">Ano Anterior</p>
                    <h4 class="card-title fw-bolder">{{ comprasAnoAnteriorQtd }}</h4>
                  </div>
                  <i class="bi bi-arrow-counterclockwise display-6 opacity-50"></i>
                </div>
                <div class="text-end mt-2">
                  <span [countUp]="comprasAnoAnteriorValorFloat" [options]="countUpOptions">
                    {{ comprasAnoAnteriorValor }}
                  </span>
                </div>
              </div>
            </a>
          </div>

          <div class="col-md-3">
            <a [routerLink]="['/compras']" [queryParams]="{ filtroDashboard: 'ano-atual' }"
              class="text-decoration-none h-100">
              <div class="animated-card bg-primary-subtle text-primary p-3 shadow-sm h-100">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="card-subtitle text-uppercase fw-bold mb-1">Ano Atual</p>
                    <h4 class="card-title fw-bolder">{{ comprasAnoAtualQtd }}</h4>
                  </div>
                  <i class="bi bi-calendar-check display-6 opacity-50"></i>
                </div>
                <div class="text-end mt-2">
                  <span [countUp]="comprasAnoAtualValorFloat" [options]="countUpOptions">
                    {{ comprasAnoAtualValor }}
                  </span>
                </div>
              </div>
            </a>
          </div>


          <div class="col-md-3">
            <a [routerLink]="['/compras']" [queryParams]="{ filtroDashboard: 'mes-anterior' }"
              class="text-decoration-none h-100">
              <div class="animated-card bg-success-light-subtle text-success p-3 shadow-sm h-100">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="card-subtitle text-uppercase fw-bold mb-1">MÃªs Anterior</p>
                    <h4 class="card-title fw-bolder">{{ comprasMesAnteriorQtd }}</h4>
                  </div>
                  <i class="bi bi-calendar-week display-6 opacity-50"></i>
                </div>
                <div class="text-end mt-2">
                  <span [countUp]="comprasMesAnteriorValorFloat" [options]="countUpOptions">
                    {{ comprasMesAnteriorValor }}
                  </span>
                </div>
              </div>
            </a>
          </div>


          <div class="col-md-3"> <!-- Compras MÃªs -->
            <a [routerLink]="['/compras']" [queryParams]="{ filtroDashboard: 'mes' }"
              class="text-decoration-none h-100">
              <div class="animated-card bg-success-light-subtle text-success p-3 shadow-sm h-100">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="card-subtitle text-uppercase fw-bold mb-1">MÃªs atual</p>
                    <h4 class="card-title fw-bolder">{{ comprasMesQtd }}</h4>
                  </div>
                  <i class="bi bi-check-circle-fill display-6 opacity-50"></i>
                </div>
                <div class="text-end mt-2">
                  <span [countUp]="comprasMesValorFloat" [options]="countUpOptions">
                    {{ comprasMesValor }}
                  </span>
                </div>
              </div>
            </a>
          </div>


          <div class="col-md-3">
            <a [routerLink]="['/compras']" [queryParams]="{ filtroDashboard: 'semana-passada' }"
              class="text-decoration-none h-100">
              <div class="animated-card bg-purple-subtle text-purple p-3 shadow-sm h-100">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="card-subtitle text-uppercase fw-bold mb-1">Semana Passada</p>
                    <h4 class="card-title fw-bolder">{{ comprasSemanaPassadaQtd }}</h4>
                  </div>
                  <i class="bi bi-arrow-left-circle display-6 opacity-50"></i>
                </div>
                <div class="text-end mt-2">
                  <span [countUp]="comprasSemanaPassadaValorFloat" [options]="countUpOptions">
                    {{ comprasSemanaPassadaValor }}
                  </span>
                </div>
              </div>
            </a>
          </div>


          <div class="col-md-3"> <!-- Compras Semana -->
            <a [routerLink]="['/compras']" [queryParams]="{ filtroDashboard: 'semana' }"
              class="text-decoration-none h-100">
              <div class="animated-card bg-purple-subtle text-purple p-3 shadow-sm h-100">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="card-subtitle text-uppercase fw-bold mb-1">Semana Atual</p>
                    <h4 class="card-title fw-bolder">{{ comprasSemanaQtd }}</h4>
                  </div>
                  <i class="bi bi-arrow-right-circle display-6 opacity-50"></i>
                </div>
                <div class="text-end mt-2">
                  <span [countUp]="comprasSemanaValorFloat" [options]="countUpOptions">
                    {{ comprasSemanaValor }}
                  </span>
                </div>
              </div>
            </a>
          </div>



          <!-- Linha 2 (2 cards) -->
          <div class="col-md-3"> <!-- Sem CobranÃ§a -->
            <a [routerLink]="['/compras']" [queryParams]="{ filtroDashboard: 'semcobranca' }"
              class="text-decoration-none h-100">
              <div class="animated-card bg-orange-subtle text-orange  p-3 shadow-sm h-100">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="card-subtitle text-uppercase fw-bold mb-1">Sem CobranÃ§a</p>
                    <h4 class="card-title fw-bolder">{{ comprasSemCobrancaQtd }}</h4>
                  </div>
                  <i class="bi bi-x-circle-fill display-6 opacity-50"></i>
                </div>
                <div class="text-end mt-2">
                  <span [countUp]="comprasSemCobrancaValorFloat" [options]="countUpOptions">
                    {{ comprasSemCobrancaValor }}
                  </span>
                </div>
              </div>
            </a>
          </div>

          <div class="col-md-3"> <!-- Manuais -->
            <a [routerLink]="['/compras']" [queryParams]="{ filtroDashboard: 'manuais' }"
              class="text-decoration-none h-100">
              <div class="animated-card bg-secondary-subtle text-secondary p-3 shadow-sm h-100">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="card-subtitle text-uppercase fw-bold mb-1">Manuais</p>
                    <h4 class="card-title fw-bolder">{{ comprasManuaisQtd }}</h4>
                  </div>
                  <i class="bi bi-pencil-square display-6 opacity-50"></i>
                </div>
                <div class="text-end mt-2">
                  <span [countUp]="comprasManuaisValorFloat" [options]="countUpOptions">
                    {{ comprasManuaisValor }}
                  </span>
                </div>
              </div>
            </a>
          </div>




          <div class="col-md-6">


            <div class="animated-card  p-3 shadow-sm h-100" style="background-color:#aec6f0; color:#0646db;">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <p class="card-subtitle text-uppercase fw-bold mb-0">TOP Fornecedor Ano</p>

                  <span *ngFor="let r of rankFornecedorAno | slice:0:3" class="d-block small lh-sm mt-1">
                    {{ r.nome }} â†’ <strong>{{ r.total | currency:'BRL'}}</strong>
                  </span>
                </div>
                <i class="bi bi-award-fill display-6 opacity-50"></i>
              </div>
            </div>

          </div>
          <div class="col-md-6">

            <div class="animated-card  p-3 shadow-sm h-100" style="background-color:#aec6f0; color:#0646db;">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <p class="card-subtitle text-uppercase fw-bold mb-0">TOP Fornecedor MÃªs</p>

                  <span *ngFor="let r of rankFornecedorMes  | slice:0:3" class="d-block small lh-sm mt-1">
                    <a [routerLink]="['/compras']"
                      [queryParams]="{ filtroDashboard: 'fornecedor', idForn: r.id, periodo: 'mes'}"
                      class="text-decoration-none text-reset fw-semibold">
                      {{ r.nome }} â†’ <strong>{{ r.total | currency:'BRL' }}</strong>
                    </a>
                  </span>
                </div>
                <i class="bi bi-award-fill display-6 opacity-50"></i>
              </div>
            </div>

          </div>








        </div>
      </div>
      <div class="col-md-6">
        <div class="row g-4">
          <h2 class="text-center cursor-pointer" (click)="abrirModal('cobrancas')">
            CobranÃ§as
          </h2>

          <div class="col-md-3">
            <a [routerLink]="['/cobranca']" [queryParams]="{ filtroDashboard: 'totalcobranca' }"
              class="text-decoration-none h-100">
              <div class="animated-card bg-primary-subtle text-primary p-3 shadow-sm h-100">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="card-subtitle text-uppercase fw-bold mb-1">Total cobranÃ§as</p>
                    <h4 class="card-title fw-bolder">{{ qtdTotalCobrancas }}</h4>
                  </div>
                  <i class="bi bi-bag-check display-6 opacity-50"></i>
                </div>
                <div class="text-end mt-2">
                  <span class="fs-6 fw-semibold text-truncate" [countUp]="totalCobrancasFloat"
                    [options]="countUpOptions">{{
                    totalValorCobranca }}</span>
                </div>
              </div>
            </a>
          </div>
          <div class="col-md-3">
            <a [routerLink]="['/cobranca']" [queryParams]="{ filtroDashboard: 'avencer' }"
              class="text-decoration-none h-100">
              <div class="animated-card bg-primary-subtle text-primary p-3 shadow-sm h-100">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="card-subtitle text-uppercase fw-bold mb-1">A Vencer</p>
                    <h4 class="card-title fw-bolder">{{ qtdCobrancasAVencer }}</h4>
                  </div>
                  <i class="bi bi-bag-check display-6 opacity-50"></i>
                </div>
                <div class="text-end mt-2">
                  <span class="fs-6 fw-semibold text-truncate" [countUp]="totalValorCobrAVencerFloat"
                    [options]="countUpOptions">{{ totalValorCobrAVencer }}</span>
                </div>
              </div>
            </a>
          </div>
          <div class="col-md-3">
            <a [routerLink]="['/cobranca']" [queryParams]="{ filtroDashboard: 'vencidadia' }"
              class="text-decoration-none h-100">
              <div class="animated-card bg-purple-subtle text-purple p-3 shadow-sm h-100">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="card-subtitle text-uppercase fw-bold mb-1">Vencendo Hoje</p>
                    <h4 class="card-title fw-bolder">{{ qtdCobrancasVencidasNoDia }}</h4>
                  </div>
                  <i class="bi bi-clock-history display-6 opacity-50"></i>
                </div>
                <div class="text-end mt-2">
                  <span class="fs-6 fw-semibold text-truncate" [countUp]="totalValorCobrVencidasDiaFloat"
                    [options]="countUpOptions">{{ totalValorCobrVencidasDia }}</span>
                </div>
              </div>
            </a>
          </div>
          <div class="col-md-3">
            <a [routerLink]="['/cobranca']" [queryParams]="{ filtroDashboard: 'vencidas' }"
              class="text-decoration-none h-100">
              <div class="animated-card bg-danger-subtle text-danger p-3 shadow-sm h-100">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="card-subtitle text-uppercase fw-bold mb-1">Vencidas</p>
                    <h4 class="card-title fw-bolder">{{ qtdCobrancasVencidas }}</h4>
                  </div>
                  <i class="bi bi-calendar-x display-6 opacity-50"></i>
                </div>
                <div class="text-end mt-2">
                  <span class="fs-6 fw-semibold text-truncate" [countUp]="totalValorCobrVencidasFloat"
                    [options]="countUpOptions">{{ totalValorCobrVencidas }}</span>
                </div>
              </div>
            </a>
          </div>

          <!-- Linha 2 (4 cards) -->
          <div class="col-md-4">
            <a [routerLink]="['/cobranca']" [queryParams]="{ filtroDashboard: 'vencidasSemPagamento' }"
              class="text-decoration-none h-100">
              <div class="animated-card bg-warning-subtle text-warning-emphasis p-3 shadow-sm h-100">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="card-subtitle text-uppercase fw-bold mb-1">A Pagar (Manual)</p>
                    <h4 class="card-title fw-bolder">{{ qtdCobrancasSemPagamento }}</h4>
                  </div>
                  <i class="bi bi-wallet-fill display-6 opacity-50"></i>
                </div>
                <div class="text-end mt-2">
                  <span class="fs-6 fw-semibold text-truncate" [countUp]="totalValorCobrSemPagamentoFloat"
                    [options]="countUpOptions">{{ totalValorCobrSemPagamento }}</span>
                </div>
              </div>
            </a>
          </div>
          <div class="col-md-4">
            <a [routerLink]="['/cobranca']" [queryParams]="{ filtroDashboard: 'proxvenc' }"
              class="text-decoration-none h-100">
              <div class="animated-card bg-orange-subtle text-orange p-3 shadow-sm h-100">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="card-subtitle text-uppercase fw-bold mb-1">a pagar essa semana</p>
                    <h4 class="card-title fw-bolder">{{ qtdCobrancasProximoVencimento }}</h4>
                  </div>
                  <i class="bi bi-calendar-event display-6 opacity-50"></i>
                </div>
                <div class="text-end mt-2">
                  <span class="fs-6 fw-semibold text-truncate" [countUp]="totalValorCobrProximoFloat"
                    [options]="countUpOptions">{{ totalValorCobrProximo }}</span>
                </div>
              </div>
            </a>
          </div>
          <div class="col-md-4">
            <a [routerLink]="['/cobranca']" [queryParams]="{ filtroDashboard: 'proxsemana' }"
              class="text-decoration-none h-100">
              <div class="animated-card bg-orange-subtle text-orange p-3 shadow-sm h-100">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="card-subtitle text-uppercase fw-bold mb-1">a pagar prÃ³x. semana</p>
                    <h4 class="card-title fw-bolder">{{ qtdCobrancasProximaSemana }}</h4>
                  </div>
                  <i class="bi bi-calendar-event display-6 opacity-50"></i>
                </div>
                <div class="text-end mt-2">
                  <span class="fs-6 fw-semibold text-truncate" [countUp]="totalValorCobrProxSemanaFloat"
                    [options]="countUpOptions">{{ totalValorCobrProxSemana }}</span>
                </div>
              </div>
            </a>
          </div>


          <!-- Linha 3 (4 cards) -->
          <div class="col-md-4">
            <a [routerLink]="['/cobranca']" [queryParams]="{ filtroDashboard: 'pagasdia' }"
              class="text-decoration-none h-100">
              <div class="animated-card bg-success-subtle text-success p-3 shadow-sm h-100">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="card-subtitle text-uppercase fw-bold mb-1">CobranÃ§as Pagas Hoje</p>
                    <h4 class="card-title fw-bolder">{{ qtdCobrancasPagasNoDia }}</h4>
                  </div>
                  <i class="bi bi-check-circle-fill display-6 opacity-50"></i>
                </div>
                <div class="text-end mt-2">
                  <span class="fs-6 fw-semibold text-truncate" [countUp]="totalValorCobrPagasDiaFloat"
                    [options]="countUpOptions">{{ totalValorCobrPagasDia }}</span>
                </div>
              </div>
            </a>
          </div>
          <div class="col-md-4">
            <a [routerLink]="['/cobranca']" [queryParams]="{ filtroDashboard: 'pagassemana' }"
              class="text-decoration-none h-100">
              <div class="animated-card bg-success-light-subtle text-success-emphasis p-3 shadow-sm h-100">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="card-subtitle text-uppercase fw-bold mb-1">CobranÃ§as Pagas Semana </p>
                    <h4 class="card-title fw-bolder">{{ qtdCobrancasPagasSemana }}</h4>
                  </div>
                  <i class="bi bi-calendar-check-fill display-6 opacity-50"></i>
                </div>
                <div class="text-end mt-2">
                  <span class="fs-6 fw-semibold text-truncate" [countUp]="totalValorCobrPagasSemanaFloat"
                    [options]="countUpOptions">{{ totalValorCobrPagasSemana }}</span>
                </div>
              </div>
            </a>
          </div>
          <div class="col-md-4">
            <a [routerLink]="['/cobranca']" [queryParams]="{ filtroDashboard: 'pagasmes' }"
              class="text-decoration-none h-100">
              <div class="animated-card bg-success-light-subtle text-success-emphasis p-3 shadow-sm h-100">
                <div class="d-flex justify-content-between align-items-start">
                  <div>
                    <p class="card-subtitle text-uppercase fw-bold mb-1">CobranÃ§as Pagas MÃªs</p>
                    <h4 class="card-title fw-bolder">{{ qtdCobrancasPagasNoMes }}</h4>
                  </div>
                  <i class="bi bi-calendar-check-fill display-6 opacity-50"></i>
                </div>
                <div class="text-end mt-2">
                  <span class="fs-6 fw-semibold text-truncate" [countUp]="totalValorCobrPagasMesFloat"
                    [options]="countUpOptions">{{ totalValorCobrPagasMes }}</span>
                </div>
              </div>
            </a>
          </div>


        </div>
      </div>


    </div>

  </div>
  <br><br>

  <div class="row g-4">

    <!-- ================= TOPO ================= -->
    <div class="col-12 text-center mb-4">

      <!-- Linha 1 -->
      <h4 class="fw-bold mb-1">Despesas Loja</h4>
      <div class="calendar-top d-flex justify-content-center align-items-center gap-4 mb-8">
        <button class="btn btn-outline-secondary" (click)="mudarMes(-1)">ðŸ¡„</button>
        <h5 class="mb-0">{{ nomeMes }}</h5>
        <button class="btn btn-outline-secondary" (click)="mudarMes(1)">ðŸ¡†</button>
      </div>

      <!-- Linha 2 -->

    </div>

    <div class="col-lg-6">

      <div class="calendar">





        <div class="calendar-legend mb-3 d-flex justify-content-center gap-3">
          <div class="d-flex justify-content-center gap-5 flex-wrap">


            <div>
              <strong>Resumo Mensal</strong>
              <div class="text-success">Pago: {{ totalMesPago | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}</div>
              <div class="text-danger">A pagar: {{ totalMesAberto | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}</div>
              <div class="fw-bold text-primary">Total: {{ totalMesGeral | currency:'BRL':'symbol':'1.2-2':'pt-BR'}}
              </div>
            </div>

            <div>
              <strong>Resumo Geral</strong>
              <div class="text-success">Pago: {{ totalGeralPago | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}</div>
              <div class="text-danger">A pagar: {{ totalGeralAberto | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}</div>
              <div class="fw-bold text-primary">Total: {{ totalGeral | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
              </div>
            </div>


          </div>
          <span class="legend-item"><span class="legend-color pago"></span> Pago</span>
          <span class="legend-item"><span class="legend-color vencido"></span> Vencido</span>
          <span class="legend-item"><span class="legend-color proximo"></span> PrÃ³ximo</span>
        </div>

        <div class="calendar-header">
          <div *ngFor="let dia of semana" class="week-day">{{ dia }}</div>
        </div>


        <div class="calendar-grid ">
          <div *ngFor="let dia of diasDoMes" class="day-cell" [ngClass]="{
            'pago': dia.status === 'pago',
            'vencido': dia.status === 'vencido',
            'proximo': dia.status === 'proximo',
            'normal': dia.status === 'normal',
            'empty': dia.vazio
          }" (mouseenter)="showTooltip(dia, $event)" (mouseleave)="hideTooltip()"
            [routerLink]="(dia.vencido || dia.proximo) && !dia.vazio ? ['/despesas-loja'] : null"
            [queryParams]="(dia.vencido || dia.proximo) && !dia.vazio ? { data: dia.data.toISOString().slice(0,10) } : null">

            <span *ngIf="dia.valorPago > 0" class="valor valor-pago">
              Pago: {{ dia.valorPago | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
            </span>

            <span *ngIf="!dia.vazio" class="day-number">{{ dia.numero }}</span>

            <span *ngIf="dia.valorAberto > 0" class="valor valor-aberto">
              Pagar: {{ dia.valorAberto | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
            </span>

          </div>
        </div>

      </div>

      <div id="tooltip-despesas" class="tooltip-custom" [innerHTML]="tooltipHtml"></div>

    </div>


    <div class="col-lg-6 d-flex flex-column ">


      <div class="ranking-clean mb-2 ranking-top-align">
        <h6 class="text-center mb-2"><strong>Ranking do MÃªs</strong></h6>

        <div class="row text-center">
          <div class="col-4" *ngFor="let item of rankingMes; let i = index">
            <strong>{{ i + 1 }}Â°</strong> {{ item.nome }}<br>
            {{ item.valor | currency:'BRL':'symbol':'1.2-2':'pt-BR'}}
          </div>
        </div>
      </div>
      <br>

      <div class="tabela-anual">
        <h6 class="text-center mb-2"><strong>Resumo Anual por Categoria</strong></h6>
        <button class="btn btn-success btn-sm d-flex align-items-center" (click)="exportarExcel()">
          <i class="bi bi-file-earmark-excel-fill me-1"></i> Excel
        </button>

        <table class="table table-sm table-bordered text-center align-middle">
          <thead class="table-light">
            <tr>
              <th>MÃªs</th>
              <th *ngFor="let cat of categoriasFixas">{{ cat }}</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let row of tabelaCategoriasAno">
              <td><strong>{{ row.mes }}</strong></td>

              <td *ngFor="let cat of categoriasFixas" [ngClass]="{
    'maior-valor': cat === row.maiorCategoria,
    'coluna-total': cat === 'Total',
    'clicked-cell': clickedCell?.mes === row.mes && clickedCell?.categoria === cat
  }" class="cell-click" [style.cursor]="cat === 'Total' ? 'default' : 'pointer'"
                (click)="cat !== 'Total' && abrirModalDespesas(cat, row.mes)">
                {{ row.valores[cat] | currency:'BRL':'symbol':'1.2-2':'pt-BR'}}
              </td>

            </tr>
          </tbody>
        </table>
        <div class="d-flex justify-content-center gap-4 p-2 bg-light border rounded">

          <h6 class="m-0">
            <strong>Total:</strong>
            {{ totalAnual | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
          </h6>

          <span class="mx-2">|</span>

          <h6 class="m-0">
            <strong>MÃ©dia:</strong>
            {{ mediaAnual | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
          </h6>




        </div>

      </div>


    </div>
  </div>

</div>
<!--<div class="row g-4">

    
    <div class="col-12 text-center mb-4">

     
      <h4 class="fw-bold mb-1">Despesas Loja</h4>
      <div class="calendar-top d-flex justify-content-center align-items-center gap-4 mb-8">
        <button class="btn btn-outline-secondary" (click)="mudarMes(-1)">ðŸ¡„</button>
        <h5 class="mb-0">{{ nomeMes }}</h5>
        <button class="btn btn-outline-secondary" (click)="mudarMes(1)">ðŸ¡†</button>
      </div>

    

    </div>

    <div class="col-lg-6">

      <div class="calendar">





        <div class="ranking-clean mb-2 ranking-top-align">
        <h6 class="text-center mb-2"><strong>Ranking do MÃªs</strong></h6>

        <div class="row text-center">
          <div class="col-4" *ngFor="let item of rankingMes; let i = index">
            <strong>{{ i + 1 }}Â°</strong> {{ item.nome }}<br>
            {{ item.valor | currency:'BRL':'symbol':'1.2-2':'pt-BR'}}
          </div>
        </div>
      </div>
      <br>

      <div class="tabela-anual">
        <h6 class="text-center mb-2"><strong>Resumo Anual por Categoria</strong></h6>
        <button class="btn btn-success btn-sm d-flex align-items-center" (click)="exportarExcel()">
          <i class="bi bi-file-earmark-excel-fill me-1"></i> Excel
        </button>

        <table class="table table-sm table-bordered text-center align-middle">
          <thead class="table-light">
            <tr>
              <th>MÃªs</th>
              <th *ngFor="let cat of categoriasFixas">{{ cat }}</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let row of tabelaCategoriasAno">
              <td><strong>{{ row.mes }}</strong></td>

              <td *ngFor="let cat of categoriasFixas" [ngClass]="{
    'maior-valor': cat === row.maiorCategoria,
    'coluna-total': cat === 'Total',
    'clicked-cell': clickedCell?.mes === row.mes && clickedCell?.categoria === cat
  }" class="cell-click" [style.cursor]="cat === 'Total' ? 'default' : 'pointer'"
                (click)="cat !== 'Total' && abrirModalDespesas(cat, row.mes)">
                {{ row.valores[cat] | currency:'BRL':'symbol':'1.2-2':'pt-BR'}}
              </td>

            </tr>
          </tbody>
        </table>
        <div class="d-flex justify-content-center gap-4 p-2 bg-light border rounded">

          <h6 class="m-0">
            <strong>Total:</strong>
            {{ totalAnual | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
          </h6>

          <span class="mx-2">|</span>

          <h6 class="m-0">
            <strong>MÃ©dia:</strong>
            {{ mediaAnual | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
          </h6>




        </div>

      </div>


    </div>

    </div>


    <div class="col-lg-6 d-flex flex-column ">


      <div class="ranking-clean mb-2 ranking-top-align">
        <h6 class="text-center mb-2"><strong>Ranking do MÃªs</strong></h6>

        <div class="row text-center">
          <div class="col-4" *ngFor="let item of rankingMes; let i = index">
            <strong>{{ i + 1 }}Â°</strong> {{ item.nome }}<br>
            {{ item.valor | currency:'BRL':'symbol':'1.2-2':'pt-BR'}}
          </div>
        </div>
      </div>
      <br>

      <div class="tabela-anual">
        <h6 class="text-center mb-2"><strong>Resumo Anual por Categoria</strong></h6>
        <button class="btn btn-success btn-sm d-flex align-items-center" (click)="exportarExcel()">
          <i class="bi bi-file-earmark-excel-fill me-1"></i> Excel
        </button>

        <table class="table table-sm table-bordered text-center align-middle">
          <thead class="table-light">
            <tr>
              <th>MÃªs</th>
              <th *ngFor="let cat of categoriasFixas">{{ cat }}</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let row of tabelaCategoriasAno">
              <td><strong>{{ row.mes }}</strong></td>

              <td *ngFor="let cat of categoriasFixas" [ngClass]="{
    'maior-valor': cat === row.maiorCategoria,
    'coluna-total': cat === 'Total',
    'clicked-cell': clickedCell?.mes === row.mes && clickedCell?.categoria === cat
  }" class="cell-click" [style.cursor]="cat === 'Total' ? 'default' : 'pointer'"
                (click)="cat !== 'Total' && abrirModalDespesas(cat, row.mes)">
                {{ row.valores[cat] | currency:'BRL':'symbol':'1.2-2':'pt-BR'}}
              </td>

            </tr>
          </tbody>
        </table>
        <div class="d-flex justify-content-center gap-4 p-2 bg-light border rounded">

          <h6 class="m-0">
            <strong>Total:</strong>
            {{ totalAnual | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
          </h6>

          <span class="mx-2">|</span>

          <h6 class="m-0">
            <strong>MÃ©dia:</strong>
            {{ mediaAnual | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
          </h6>




        </div>

      </div>


    </div>
  </div>!-->


<!--<div class="col-lg-6">
  <div class="card p-3 shadow-sm animated-card">
    <h5 class="card-title">CobranÃ§as Vencidas (Resumo)</h5>
    <ul class="list-group list-group-flush">
      <li *ngFor="let cobranca of cobranca | slice:0:5"
        class="list-group-item d-flex justify-content-between align-items-center">
        <span class="text-danger fw-bold"><i class="bi bi-x-circle me-1"></i> {{ cobranca.fornecedor.fornecedo
          }}</span>
        <span class="badge text-bg-danger">{{ cobranca.valorCobr | currency:'BRL' }}</span>
      </li>
      <li class="list-group-item text-center">
        <a routerLink="/cobranca" [queryParams]="{ filtroDashboard: 'vencidas' }">Ver todas ({{ qtdCobrancasVencidas
          }})</a>
      </li>
    </ul>
  </div>
</div>
<div class="col-lg-6">
  <div class="card p-3 shadow-sm animated-card">
    <h5 class="card-title">DistribuiÃ§Ã£o de cobranÃ§as</h5>
    <canvas id="chartConsolidado"></canvas>
  </div>

</div>!-->

<div class="modal fade" id="modalResumo" tabindex="-1">
  <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">

      <div class="modal-header position-relative">


        <h5 class="modal-title mb-0">
          Resumo Anual â€“ {{ tipoSelecionado | titlecase }}
        </h5>


        <div class="d-flex align-items-center gap-2 position-absolute start-50 translate-middle-x" style="left: 47%;">

          <button class="btn btn-outline-secondary btn-sm" (click)="alterarAno(-1)"> ðŸ¡„ </button>

          <span class="fw-bold fs-5"> {{ anoAtual }} </span>

          <button class="btn btn-outline-secondary btn-sm" (click)="alterarAno(1)"> ðŸ¡† </button>
        </div>


        <div class="ms-auto d-flex align-items-center gap-2">
          <button class="btn btn-success btn-sm btn-sm" title="Exportar para Excel"
            (click)="exportarExcelResumoCompra(2025, anoAtual)">
            <i class="bi bi-file-earmark-excel"></i>
          </button>

          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

      </div>



      <div class="modal-body">
        <table class="table table-bordered table-sm text-center align-middle resumo-anual">
          <thead class="table-dark">
            <tr>
              <th>MÃªs</th>

              <th *ngFor="let fp of formasPagamento">
                {{ fp }}
              </th>

              <th>TOTAL</th>
              <th>MÃ‰DIA</th>
            </tr>
          </thead>

          <tbody>
            <!-- LINHAS DOS MESES -->
            <tr *ngFor="let row of tabelaFormaPagAno; let i = index">
              <td><strong>{{ row.mes }}</strong></td>

              <td *ngFor="let fp of formasPagamento" class="bg-verde cell-click" style="cursor: pointer"
                (click)="abrirModalResumoFormaPag(row.mes, fp)">
                {{ row.valores[fp] | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
              </td>


              <td class="fw-bold">
                {{ row.total | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
              </td>

              <!-- MÃ‰DIA % ÃšNICA -->
              <td class="fw-bold"
                [ngClass]="{'perc-baixo': row.percentualAnual < 80,'perc-medio': row.percentualAnual >= 80 && row.percentualAnual < 100, 'perc-alto': row.percentualAnual > 100}">
                {{ row.percentualAnual | number:'1.2-2' }}%
              </td>


            </tr>

            <!-- LINHA MÃ‰DIA POR FORMA DE PAGAMENTO -->
            <tr class="table-secondary fw-bold">
              <td>MÃ‰DIA</td>

              <td *ngFor="let fp of formasPagamento">
                {{ mediaPorFormaPag[fp] | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
              </td>

              <td>
                {{ mediaTotalGeral | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
              </td>

              <td></td>
            </tr>

            <!-- LINHA TOTAL POR FORMA DE PAGAMENTO -->
            <tr class="table-secondary fw-bold">
              <td>TOTAL</td>

              <td *ngFor="let fp of formasPagamento">
                {{ totalPorFormaPag[fp] | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
              </td>

              <td>
                {{ totalGeral | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
              </td>

              <td></td>
            </tr>
          </tbody>
        </table>


      </div>

    </div>
  </div>
</div>


<div class="modal fade" id="despesasModal" tabindex="-1" aria-labelledby="despesasModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title" id="despesasModalLabel">
          {{ categoriaModal }} - {{ mesModal }}
          <span class="badge bg-primary ms-2">{{ listaDespesasFiltradas.length }}</span>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">

        <table class="table table-striped">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Obs</th>
              <th>Data</th>
              <th>Valor Pago</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let d of listaDespesasFiltradas">
              <td>{{ d.despesa }}</td>
              <td>{{d.observacao}}</td>
              <td>{{d.dataPagamento | date: 'dd/MM/yyyy' }}</td>
              <td>{{ d.valorPago | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}</td>

            </tr>
          </tbody>
        </table>

        <hr />
        <h5>Total: {{ totalModal |currency:'BRL':'symbol':'1.2-2':'pt-BR' }}</h5>

      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Fechar
        </button>
      </div>

    </div>
  </div>
</div>
<div class="modal fade" id="modalResumoFormaPag" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">
          {{ formaPagModal }} â€“ {{ mesResumoModal }}
          <span class="badge bg-primary ms-2">
            {{ listaResumoFormaPag.length }}
          </span>
        </h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <table class="table table-striped table-sm">
          <thead>
            <tr>
              <th>Fornecedor / Cliente</th>
              <th>Data</th>
              <th>Forma Pag.</th>
              <th>Valor</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let i of listaResumoFormaPag">
              <td>{{ i.fornecedor || i.cliente }}</td>
              <td>
                {{ (i.dataEntrega || i.dataNota) | date:'dd/MM/yyyy' }}
              </td>
              <td>{{ i.formaPag }}</td>
              <td>
                {{ i.valorCompra | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
              </td>
            </tr>
          </tbody>
        </table>

        <hr />
        <h5 class="text-end">
          Total:
          {{ totalResumoFormaPag | currency:'BRL':'symbol':'1.2-2':'pt-BR' }}
        </h5>
      </div>

    </div>
  </div>
</div>


<div>
  <div class="modal fade" id="compras" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel" style="color: black;">

          </h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Escolha uma aÃ§Ã£o </p>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-warning" data-bs-dismiss="modal" routerLink="/compras">Consultar</button>
          <button type="button" class="btn btn-success" data-bs-dismiss="modal" data-bs-toggle="modal"
            data-bs-target="#cadastrarCompras">Cadastrar</button>

        </div>
      </div>
    </div>
  </div>
</div>





<div class="modal fade" id="cadastrarCompras" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-content">
        <div class="modal-header text-center">
          <h1 class="modal-title fs-5 w-100" id="exampleModalLabel">Cadastrar compras</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="formCompras">
            <div class="container text-center">
              <div class="row justify-content-center">
                <div class="col-12">
                  <!-- Primeira linha -->
                  <div class="row">
                    <div class="col-md-3">
                      <label><strong>Fornecedor</strong></label>
                      <input type="text" class="form-control" [value]="selectedFornecedor?.fornecedo || ''"
                        (input)="onGenericFornecedorInput($event, 'idForn')" list="fornecedoresList"
                        placeholder="Digite o nome do fornecedor" />
                    </div>

                    <!-- EMPRESA FRETE -->
                    <div class="col-md-3">
                      <label><strong>Empresa frete</strong></label>
                      <input type="text" class="form-control" [value]="selectedEmpresaFrete?.fornecedo || ''"
                        (input)="onGenericFornecedorInput($event, 'idEmpFrete')" list="fornecedoresList"
                        placeholder="Digite o nome da empresa de frete" />
                    </div>

                    <!-- ÃšNICO DATALIST COMPARTILHADO -->
                    <datalist id="fornecedoresList">
                      <option *ngFor="let f of fornecedor" [value]="f.fornecedo"></option>
                    </datalist>
                    <div class="col-md-2">
                      <label><strong>NÂ° nota fiscal</strong></label>
                      <input type="text" class="form-control text-center" placeholder="NÂ°" formControlName="numNF" />
                    </div>
                    <div class="col-md-2">
                      <label><strong>NÂ° Nota</strong></label>
                      <input type="text" class="form-control text-center" placeholder="NÂ°" formControlName="numNota" />
                    </div>
                    <div class="col-md-2">
                      <label><strong>Loja</strong></label>
                      <select class="form-select " formControlName="loja">

                        <option *ngFor="let loja of loja" [value]="loja">{{ loja }}</option>
                      </select>
                    </div>
                  </div>
                  <hr>
                  <div class="row justify-content-center">
                    <div class="col-md-2">
                      <label><strong>Valor compra</strong></label>
                      <input type="text" class="form-control text-center" placeholder="R$"
                        formControlName="valorCompra" />
                    </div>
                    <div class="col-md-2">
                      <label><strong>Valor NF</strong></label>
                      <input type="text" class="form-control text-center" placeholder="R$" formControlName="valorNF" />
                    </div>
                    <div class="col-md-2">
                      <label><strong>Valor outros</strong></label>
                      <input type="text" class="form-control text-center" placeholder="R$"
                        formControlName="valorOutro" />
                    </div>
                    <div class="col-md-2">
                      <label><strong>Forma de pag</strong></label>
                      <select class="form-select " formControlName="formaPag">

                        <option *ngFor="let fp of formaPag" [value]="fp">{{ fp }}</option>
                      </select>
                    </div>

                    <div class="col-md-2">
                      <label><strong>Data nota</strong></label>
                      <input type="date" class="form-control text-center" formControlName="dataNota" />
                    </div>
                    <div class="col-md-2">
                      <label><strong>Data entrega</strong></label>
                      <input type="date" class="form-control text-center" formControlName="dataEntrega" />
                    </div>

                  </div>

                  <hr>
                  <div class="row justify-content-center ">

                    <div class="col-md-2">
                      <label><strong>Forma pag frete</strong></label>
                      <select class="form-select " formControlName="formaPagFrete">
                        <option value=""> Selecione </option>
                        <option *ngFor="let fp of formaPag" [value]="fp">{{ fp }}</option>
                      </select>
                    </div>
                    <div class="col-md-2">
                      <label><strong>Valor frete</strong></label>
                      <input type="text" class="form-control text-center" placeholder="R$"
                        formControlName="valorFrete" />
                    </div>

                    <div class="col-md-6 ">
                      <label><strong>ObservaÃ§Ã£o</strong></label>
                      <textarea class="form-control text-center" placeholder="Digite aqui"
                        formControlName="obs"></textarea>
                    </div>
                  </div>
                  <hr>


                  <div class="modal-footer text-center">
                    <div class="w-100">
                      <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancelar</button>
                      <button type="button" class="btn btn-success" data-bs-dismiss="modal"
                        (click)="CadastrarCompras()">Cadastrar</button>
                    </div>
                  </div>

                </div>

              </div>

            </div>
          </form>
        </div>

      </div>
    </div>
  </div>

</div>


<div class="modal fade" id="cadastrarCobrancas" tabindex="-1" aria-labelledby="exampleModalLabel">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h1 class="modal-title fs-5 w-100" id="exampleModalLabel">Cadastrar cobranÃ§as</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <form [formGroup]="formCobrancas">
          <div formArrayName="cobrancas">
            <div *ngFor="let cobranca of cobrancas.controls; let i = index" [formGroupName]="i"
              class="border rounded p-3 mb-3">
              <h5 class="text-start mb-3 text-center">CobranÃ§a {{ i + 1 }}</h5>
              <div class="row justify-content-center">

                <div class="col-md-2 text-center">
                  <label><strong>Id compra</strong></label>
                  <input type="text" class="form-control text-center" placeholder="ID" formControlName="idCompra" />

                </div>
                <div class="col-md-5 text-center">
                  <label><strong>Fornecedor</strong></label>
                  <select class="form-select text-center" formControlName="idForn">
                    <option value=""> Selecione um fornecedor</option>
                    <option *ngFor="let f of fornecedor" [value]="f.id">{{ f.fornecedo | uppercase }}</option>
                  </select>
                  <div class="text-danger"
                    *ngIf="cobrancas.at(i).get('idForn')?.touched && cobrancas.at(i).get('idForn')?.invalid">
                    Selecione um fornecedor da cobranÃ§a
                  </div>
                </div>

              </div>
              <div class="row justify-content-center">


                <div class="col-md-2 text-center">
                  <label><strong>NÂ° da nota</strong></label>
                  <input type="text" class="form-control text-center" placeholder="NÂ°" formControlName="numNota" />

                </div>
                <div class="col-md-2 text-center">
                  <label><strong>NÂ° nota fiscal</strong></label>
                  <input type="text" class="form-control text-center" placeholder="NÂ°" formControlName="numNF" />
                </div>
                <div class="col-md-2 text-center">
                  <label><strong>Valor frete</strong></label>
                  <input type="text" class="form-control text-center" placeholder="R$" formControlName="valorFrete" />
                </div>
                <div class="col-md-2 text-center">
                  <label><strong>Valor total</strong></label>
                  <input type="text" class="form-control text-center" placeholder="R$" formControlName="valorCompra" />
                </div>
                <div class="col-md-3">
                  <label><strong>Loja</strong></label>
                  <select class="form-select " formControlName="loja">
                    <option value=""> Selecione </option>
                    <option *ngFor="let loja of loja" [value]="loja">{{ loja }}</option>
                  </select>
                </div>


              </div>

              <hr>
              <div class="row mt-2 text-center">
                <div class="col-md-1">
                  <label><strong>Parcela</strong></label>
                  <input type="text" class="form-control text-center" formControlName="parcela" />
                </div>
                <div class="col-md-3">
                  <label><strong>Data vencimento</strong></label>
                  <input type="date" class="form-control text-center" formControlName="dataVenc" />
                </div>
                <div class="col-md-2">
                  <label><strong>Valor</strong></label>
                  <input type="text" class="form-control text-center" placeholder="R$" formControlName="valorCobr" />
                </div>

                <div class="col-md-3">
                  <label><strong>Tipo cobranÃ§a</strong></label>
                  <select class="form-select text-center" formControlName="tipoCobr">
                    <option value=""> Selecione </option>
                    <option *ngFor=" let form of formaPag" [value]="form">{{form}}</option>
                  </select>
                </div>
                <div class="col-md-3">
                  <label><strong>NÂ° cobranÃ§a</strong></label>
                  <input type="text" class="form-control text-center" placeholder="NÂ°" formControlName="numCobr" />
                </div>
              </div>

              <hr>


              <div class="row mt-2 text-center">
                <div class="col-md-12">
                  <label><strong>ObservaÃ§Ã£o</strong></label>
                  <textarea class="form-control text-center" placeholder="Digite aqui" formControlName="obs"></textarea>
                </div>
              </div>

              <div class="mt-2 d-flex align-items-center">
                <div class="flex-grow-1">
                  <div *ngIf="!valorCobradoIgualValorTotal" class="msg-erro"
                    title="Erro: soma dos valores cobrados nÃ£o bate com o valor total">
                    <small class="piscar" style="color: red; font-weight: bold;">
                      â— Valores cobrados NÃƒO batem com o valor total!
                    </small>
                  </div>
                </div>

                <button type="button" class="btn btn-danger btn-sm ms-2" (click)="removerCobranca(i)"
                  title="Remover cobranÃ§a {{ i + 1 }}">
                  <i class="bi bi-trash"></i>
                </button>
              </div>

            </div>
          </div>
        </form>
      </div>

      <div class="col-md-9">
        <div class="d-flex gap-2 mt-1">
          <button type="button" class="btn btn-success" (click)="adicionarCobranca()">
            <i class="bi bi-plus-circle me-1"></i><strong>Adicionar</strong>
          </button>

          <button type="button" class="btn btn-danger" (click)="removerUltimaCobranca()"
            [disabled]="cobrancas.length === 0">
            <i class="bi bi-trash"></i> Remover
          </button>
        </div>
      </div>

      <div class="modal-footer text-center">
        <div class="w-100">
          <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-success" data-bs-dismiss="modal"
            (click)="CadastrarCobranca()">Cadastrar</button>
        </div>
      </div>
    </div>
  </div>
</div>


<ngx-spinner bdColor="rgba(0, 0, 0, 0.8)" size="medium" color="#fff" type="ball-clip-rotate" [fullScreen]="true">
  <p style="color: white">Aguarde a realizaÃ§Ã£o do cadastro...</p>
</ngx-spinner>


<div class="modal fade" id="modalConfirmarCobranca" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center">
      <div class="modal-header">
        <h5 class="modal-title w-100">Cadastro de CobranÃ§a</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <p>Deseja cadastrar uma cobranÃ§a para a compra do <strong>
            <h1 style="color: rgba(8, 98, 13, 0.814);">ID : {{ ultimaCompra?.id }} ?</h1>
          </strong></p>
      </div>
      <div class="modal-footer justify-content-center">
        <!-- BotÃ£o "NÃ£o" atualizado -->
        <button type="button" class="btn btn-secondary" (click)="cancelarCriacaoCobranca()">NÃ£o</button>

        <button type="button" class="btn btn-primary" (click)="confirmarCriarCobranca()">Sim</button>
      </div>
    </div>
  </div>
</div>





<div class="modal fade" id="despesas" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg ">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h1 class="modal-title fs-5 w-100" id="exampleModalLabel">Cadastrar despesas</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <form [formGroup]="formDespesas">
          <div class="container text-center">
            <div class="row justify-content-center">
              <div class="col-12">

                <!-- Primeira linha -->
                <div class="row mb-16">
                  <div class="col-md-6">
                    <label><strong>Nome</strong></label>
                    <input type="text" class="form-control text-center" placeholder="Digite aqui"
                      formControlName="nomeLocal" />
                  </div>
                  <div class="col-md-6">
                    <label><strong>Despesa</strong></label>
                    <select class="form-select text-center" formControlName="nomeDespesa">
                      <option value=""> Selecione </option>
                      <option *ngFor=" let form of tipoDespesa" [value]="form">{{form}}</option>
                    </select>
                  </div>


                </div>
                <hr>
                <!-- Segunda linha -->
                <div class="row mb-12 row justify-content-center">
                  <div class="col-md-3">
                    <label><strong>Valor</strong></label>
                    <input type="text" class="form-control text-center" placeholder="R$ 0,00" formControlName="valor" />

                  </div>

                  <div class="col-md-2">
                    <label><strong>Quantidade</strong></label>
                    <input type="text" class="form-control text-center" placeholder="x" formControlName="quantidade" />
                  </div>
                  <div class="col-md-3">
                    <label><strong>Loja</strong></label>
                    <select class="form-select " formControlName="loja">
                      <option value=""> Selecione </option>
                      <option *ngFor="let loja of loja" [value]="loja">{{ loja }}</option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <label><strong>Pagamento</strong></label>
                    <select class="form-select text-center" formControlName="formaPagamento">
                      <option value=""> Selecione </option>
                      <option *ngFor=" let form of formaPagDespesa" [value]="form">{{form}}</option>
                    </select>
                  </div>

                </div>
                <hr>

                <div class="row mb-18 justify-content-center">
                  <div class="col-md-5">
                    <label><strong>Data compra</strong></label>
                    <input type="date" class="form-control text-center" formControlName="dataCompra" />
                  </div>
                  <div class="col-md-7 ">
                    <label><strong>Obs</strong></label>
                    <textarea class="form-control text-center" placeholder="ObservaÃ§Ã£o"
                      formControlName="observacao"></textarea>
                  </div>

                </div>

                <hr>

              </div>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer text-center">
        <div class="w-100">
          <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-success" data-bs-dismiss="modal"
            (click)="cadastrarDespesas()">Cadastrar</button>
        </div>
      </div>
    </div>
  </div>
</div>



<div class="modal fade" id="cadastrarFornecedor" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h1 class="modal-title fs-5 w-100" id="exampleModalLabel">Cadastrar Fornecedor</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <form [formGroup]="formFornecedor">
          <div class="container text-center">
            <div class="row justify-content-center">
              <div class="col-12">

                <!-- Primeira linha -->
                <div class="row mb-2">
                  <div class="col-md-6">
                    <label><strong>RazÃ£o social</strong></label>
                    <input type="text" class="form-control text-center" placeholder="Digite aqui"
                      formControlName="empresa" />
                  </div>
                  <div class="col-md-6">
                    <label><strong>CNPJ</strong></label>
                    <input type="text" class="form-control text-center" placeholder="00.000.000/0000-00"
                      formControlName="cnpj" (input)="formatarCNPJ($event)" />
                  </div>
                </div>

                <div class="row mb-2">
                  <div class="col-md-12">
                    <label><strong>EndereÃ§o</strong></label>
                    <input type="text" class="form-control text-center" placeholder="Digite aqui"
                      formControlName="endereco" />
                  </div>
                </div>

                <hr>

                <!-- Segunda linha -->
                <div class="row mb-2">
                  <div class="col-md-6">
                    <label><strong>Telefone</strong></label>
                    <input type="text" class="form-control text-center" placeholder="(00) 00000-0000"
                      formControlName="telefone" (input)="formatarTelefone($event)" />

                  </div>
                  <div class="col-md-6">
                    <label><strong>Fornecedor</strong></label>
                    <input type="text" class="form-control text-center" placeholder="Digite aqui"
                      formControlName="fornecedo" />
                  </div>
                </div>

                <div class="row mb-2">
                  <div class="col-md-6">
                    <label><strong>Tipo Fornecedor</strong></label>
                    <select class="form-select text-center" formControlName="tipoFornecedor">
                      <option value=""> Selecione </option>
                      <option *ngFor=" let tipo of tipoFornec" [value]="tipo">{{tipo}}</option>
                    </select>
                  </div>
                  <div class="col-md-6">
                    <label><strong>Vendedor</strong></label>
                    <input type="text" class="form-control text-center" placeholder="Digite aqui"
                      formControlName="vendedor" />
                  </div>
                </div>

                <div class="row mb-3">
                  <div class="col-md-6">
                    <label><strong>Tel - Vendedor</strong></label>
                    <input type="text" class="form-control text-center" placeholder="(00) 00000-0000"
                      formControlName="teleVendedor" (input)="formatarTelefoneVendedor($event)" />
                  </div>
                  <div class="col-md-6 ">
                    <label><strong>obs</strong></label>
                    <textarea class="form-control text-center" placeholder="ObservaÃ§Ã£o"
                      formControlName="obs"></textarea>
                  </div>
                </div>

                <hr>

              </div>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer text-center">
        <div class="w-100">
          <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-success" data-bs-dismiss="modal"
            (click)="CadastrarFornecedo()">Cadastrar</button>
        </div>
      </div>
    </div>
  </div>
</div>